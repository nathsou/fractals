import{n as e,t}from"./vendor.080e648e.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const n={},r={zero:()=>r.of(0,0),one:()=>r.of(1,0),i:()=>r.of(0,1),NaN:()=>r.of(NaN,NaN),isNaN:([e,t])=>Number.isNaN(e)||Number.isNaN(t),isReal:([e,t])=>0===t,isImaginary:([e,t])=>0===e&&0!==t,of:(e,t)=>[e,t],add:([e,t],[n,r])=>[e+n,t+r],sub:([e,t],[n,r])=>[e-n,t-r],times:([e,t],n)=>[e*n,t*n],mult:([e,t],[n,r])=>[e*n-t*r,e*r+n*t],div:([e,t],[n,c])=>{const o=n*n+c*c;return 0===o?r.NaN():[(e*n+t*c)/o,(t*n-e*c)/o]},powScalar:(e,t)=>{const n=Math.pow(r.abs(e),t),c=t*r.arg(e);return[n*Math.cos(c),n*Math.sin(c)]},pow:(e,[t,n])=>{const c=r.abs(e),o=r.arg(e),a=n*Math.log(c)+t*o,s=c**t*Math.exp(-n*o);return[s*Math.cos(a),s*Math.sin(a)]},abs:([e,t])=>Math.sqrt(e*e+t*t),arg:([e,t])=>Math.atan2(t,e),conj:([e,t])=>[e,-t],dist:(e,t)=>r.abs(r.sub(e,t)),ln:e=>[Math.log(r.abs(e)),r.arg(e)],sin:e=>{const{add:t,sub:n,mult:c,div:o}=r,a=c(e,e),s=c(e,a),l=c(s,a),i=c(l,a),u=c(i,a),p=c(u,a),d=c(p,a),v=c(d,a),f=o(s,[6,0]),h=o(l,[120,0]),m=o(i,[5040,0]),x=o(u,[362880,0]),g=o(p,[39916800,0]),z=o(d,[6227020800,0]),_=o(v,[1307674368e3,0]);return n(t(n(t(n(t(n(e,f),h),m),x),g),z),_)},cos:e=>{const{add:t,sub:n,mult:c,div:o}=r,a=c(e,e),s=c(a,a),l=c(s,a),i=c(l,a),u=c(i,a),p=c(u,a),d=c(p,a),v=o(a,[2,0]),f=o(s,[24,0]),h=o(l,[720,0]),m=o(i,[40320,0]),x=o(u,[3628800,0]),g=o(p,[479001600,0]),z=o(d,[87178291200,0]);return n(t(n(t(n(t(n(e,v),f),h),m),x),g),z)}},{abs:c,div:o,sub:a,add:s,times:l}=r,i=(e,t,n=(t=>((e,t,n=r.of(10**-4,0))=>o(a(e(s(t,n)),e(a(t,n))),l(n,2)))(e,t)),i=1e-12,u=40)=>{let p=t;const d=[];for(let r=0;r<u;r++){const t=o(e(p),n(p));if(p=a(p,t),d.push(p),c(t)<i)return d}return[]},u=["z^3 - 1","z^3 - 2 * z + 3","z^4 - 1","z^z - 2","z^z^z - 2","log(z)","z^log(z + i) - 1"],p=e=>{switch(e.type){case"VARIABLE_OR_LITERAL":switch(e.value){case"z":return{type:"literal",name:"z"};case"i":return{type:"complex",a:{type:"real",x:0},b:{type:"real",x:1}};default:return{type:"complex",a:{type:"real",x:Number(e.value)},b:{type:"real",x:0}}}case"OPERATOR":switch(e.value){case"+":{const t=p(e.left),n=p(e.right);return"complex"===t.type&&"complex"===n.type?{type:"complex",a:{type:"binary_op",op:"+",lhs:t.a,rhs:n.a},b:{type:"binary_op",op:"+",lhs:t.b,rhs:n.b}}:{type:"binary_op",op:"+",lhs:t,rhs:n}}case"-":{if(void 0===e.right)return{type:"unary_op",op:"-",arg:p(e.left)};const t=p(e.left),n=p(e.right);return"complex"===t.type&&"complex"===n.type?{type:"complex",a:{type:"binary_op",op:"-",lhs:t.a,rhs:n.a},b:{type:"binary_op",op:"-",lhs:t.b,rhs:n.b}}:{type:"binary_op",op:"-",lhs:t,rhs:n}}case"*":return{type:"binary_op",op:"*",lhs:p(e.left),rhs:p(e.right)};case"/":return{type:"binary_op",op:"/",lhs:p(e.left),rhs:p(e.right)};case"^":{const t=p(e.left),n=p(e.right);return{type:"binary_op",op:"complex"===n.type&&"real"===n.b.type&&0===n.b.x?"^x":"^",lhs:t,rhs:n}}}case"FUNCTION":return{type:"func",value:e.value,arg:p(e.right)}}},d=t=>p(e.tree(t)),v=(e,t)=>{switch(e.type){case"literal":switch(e.name){case"z":return t}break;case"real":return[e.x,0];case"unary_op":switch(e.op){case"-":return r.times(v(e.arg,t),-1)}case"binary_op":const n=v(e.lhs,t),c=v(e.rhs,t);switch(e.op){case"+":return r.add(n,c);case"-":return r.sub(n,c);case"*":return r.mult(n,c);case"/":return r.div(n,c);case"^":return r.pow(n,c);case"^x":return r.powScalar(n,c[0])}case"func":const o=v(e.arg,t);switch(e.value){case"log":return r.ln(o);case"sin":return r.sin(o);case"cos":return r.cos(o);case"sqrt":return r.powScalar(o,.5)}case"complex":const[a]=v(e.a,t),[,s]=v(e.b,t);return[a,s]}throw Error(`invalid expression: ${JSON.stringify(e,null,2)}`)},f=e=>{switch(e.type){case"literal":return e.name;case"unary_op":switch(e.op){case"-":return`(-1.0 * ${f(e.arg)})`}case"binary_op":const t=f(e.lhs),n=f(e.rhs);switch(e.op){case"+":return`${t} + ${n}`;case"-":return`${t} - ${n}`;case"*":return`cplx_mult(${t}, ${n})`;case"/":return`cplx_div(${t}, ${n})`;case"^":return`cplx_pow(${t}, ${n})`;case"^x":return`cplx_pow_scalar(${t}, ${n}.x)`}case"func":const r=f(e.arg);switch(e.value){case"log":return`cplx_ln(${r})`;case"sin":return`cplx_sin(${r})`;case"cos":return`cplx_cos(${r})`;case"sqrt":return`cplx_pow_scalar(${r}, 0.5)`}case"real":const c=Number(e.x);return Number.isInteger(c)?`${c}.0`:`${c}`;case"complex":return`vec2(${f(e.a)}, ${f(e.b)})`}},h=e=>t=>v(e,t),m=t=>{const n=d(t);return{f:f(n),native:h(n),df:f(d(`${e.diff(t,"z")}`))}},x=(e,t,n,r,c)=>(e-t)*(c-r)/(n-t)+r,g=(e,t,n,c,o=!1,a)=>{const s=e.getContext("2d");if(null!==s){if(s.clearRect(0,0,e.width,e.height),r.isNaN(c))return;if(!o){s.lineWidth=2,s.strokeStyle="white",s.beginPath();const[e,r]=t(c);s.moveTo(e,r);for(const[o,l]of i(n,c,a).map(t))s.lineTo(o,l);s.stroke()}}},z=(e,t,n,c=1)=>{const o=document.querySelector("#cnv"),a=document.querySelector("#overlay");o.width=e,o.height=t,a.width=e,a.height=t;let s=!1;const l={offset:{x:0,y:0},scale:c},i=(e,t,n=l.scale)=>[e/n+l.offset.x,t/n+l.offset.y],u=()=>{const e=1/l.scale,t=e*o.width/o.height,[n,r]=[-t+l.offset.x,t+l.offset.x],[c,a]=[e+l.offset.y,-e+l.offset.y];return{d1:n,d2:r,d3:c,d4:a}},p=([e,t])=>{const{d1:n,d2:r,d3:c,d4:a}=u();return[x(e,n,r,0,o.width),x(t,c,a,0,o.height)]},d={value:r.NaN(),clickTimestamp:0},v=((e,t)=>{const n=e.getContext("webgl",{preserveDrawingBuffer:!0});if(null===n)throw new Error("could not get webgl context");const r=e=>{const t=n.createShader(n.VERTEX_SHADER);if(null===t)throw new Error("vertShader is null");const{vertex:r,fragment:c}=(e=>({vertex:"        \n    precision highp float;\n\n    attribute vec2 a_pos;\n    uniform vec2 u_res;\n    uniform float u_zoom;\n    uniform vec2 u_center;\n    varying vec2 v_pos;\n    \n    void main() {\n      gl_Position = vec4(a_pos, 0, 1);\n      v_pos = (1.0 / u_zoom) * a_pos + u_center;\n      v_pos.x *= u_res.x / u_res.y;\n    }\n  ",fragment:`\n    precision highp float;\n\n    #define MAX_ITERS ${e.maxIterations}\n    #define ETA ${e.convergencePrecision}\n\n    varying vec2 v_pos;\n\n    vec2 cplx_mult(vec2 a, vec2 b) {\n      return vec2(a.x * b.x - a.y * b.y, a.y * b.x + a.x * b.y);\n    }\n\n    vec2 cplx_div(vec2 a, vec2 b) {\n      float d = b.x * b.x + b.y * b.y;\n\n      return vec2(\n        (a.x * b.x + a.y * b.y) / d,\n        (a.y * b.x - a.x * b.y) / d\n      );\n    }\n\n    float cplx_arg(vec2 z) {\n      return atan(z.y, z.x);\n    }\n\n    vec2 cplx_pow_scalar(vec2 z, float p) {\n      float c_p = pow(length(z), p);\n      float angle = p * cplx_arg(z);\n      return vec2(c_p * cos(angle), c_p * sin(angle));\n    }\n\n    vec2 cplx_ln(vec2 z) {\n      return vec2(log(length(z)), cplx_arg(z));\n    }\n\n    vec2 cplx_pow(vec2 z, vec2 w) {\n      float p = length(z);\n      float theta = cplx_arg(z);\n      float c = w.x;\n      float d = w.y;\n      float v = d * log(p) + c * theta;\n\n      return pow(p, c) * exp(-d * theta) * vec2(cos(v), sin(v));\n    }\n\n    vec2 cplx_sin(vec2 z) {\n      vec2 z2 = cplx_mult(z, z);\n      vec2 z3 = cplx_mult(z, z2);\n      vec2 z5 = cplx_mult(z3, z2);\n      vec2 z7 = cplx_mult(z5, z2);\n      vec2 z9 = cplx_mult(z7, z2);\n      vec2 z11 = cplx_mult(z9, z2);\n      vec2 z13 = cplx_mult(z11, z2);\n      vec2 z15 = cplx_mult(z13, z2);\n\n      vec2 t2 = cplx_div(z3, vec2(6.0, 0.0));\n      vec2 t3 = cplx_div(z5, vec2(120.0, 0.0));\n      vec2 t4 = cplx_div(z7, vec2(5040.0, 0.0));\n      vec2 t5 = cplx_div(z9, vec2(362880.0, 0.0));\n      vec2 t6 = cplx_div(z11, vec2(39916800.0, 0.0));\n      vec2 t7 = cplx_div(z13, vec2(6227020800.0, 0.0));\n      vec2 t8 = cplx_div(z15, vec2(1307674368000.0, 0.0));\n\n      return z - t2 + t3 - t4 + t5 - t6 + t7 - t8;\n    }\n\n    vec2 cplx_cos(vec2 z) {\n      vec2 z2 = cplx_mult(z, z);\n      vec2 z4 = cplx_mult(z2, z2);\n      vec2 z6 = cplx_mult(z4, z2);\n      vec2 z8 = cplx_mult(z6, z2);\n      vec2 z10 = cplx_mult(z8, z2);\n      vec2 z12 = cplx_mult(z10, z2);\n      vec2 z14 = cplx_mult(z12, z2);\n\n      vec2 t2 = cplx_div(z2, vec2(2.0, 0.0));\n      vec2 t3 = cplx_div(z4, vec2(24.0, 0.0));\n      vec2 t4 = cplx_div(z6, vec2(720.0, 0.0));\n      vec2 t5 = cplx_div(z8, vec2(40320.0, 0.0));\n      vec2 t6 = cplx_div(z10, vec2(3628800.0, 0.0));\n      vec2 t7 = cplx_div(z12, vec2(479001600.0, 0.0));\n      vec2 t8 = cplx_div(z14, vec2(87178291200.0, 0.0));\n\n      return z - t2 + t3 - t4 + t5 - t6 + t7 - t8;\n    }\n\n    vec3 newton_method(vec2 z0, float eps) {\n      vec2 z = vec2(z0);\n      float n = 0.0;\n\n      for (int j = 0; j < MAX_ITERS; j++) {\n        vec2 delta = cplx_div(${e.function.f}, ${e.function.df});\n        z -= delta;\n        n++;\n\n        if (length(delta) < eps) {\n          break;\n        }\n      }\n\n      return vec3(z, n);\n    }\n\n    vec3 hsv2rgb(vec3 c) {\n      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 root_color(vec2 z, float n) {\n      float p = float(${e.brightnessFactor}); // color brightness factor\n      float m = 1.0 - (exp(p * n / float(MAX_ITERS)) - 1.0) / (exp(p) - 1.0);\n      float hue = cplx_arg(z) / 6.2831853072 * float(${e.colorAngleFactor});\n      return hsv2rgb(vec3(hue, 1.0, m));\n    }\n\n    void main() {\n      vec3 color = vec3(0.0);\n      vec3 r = newton_method(v_pos, ETA);\n\n      if (r.z > 0.0) {\n        float m = r.z / float(MAX_ITERS);\n        color = mix(root_color(vec2(r.x, r.y), r.z), vec3(0.0), m);\n      } else {\n        color = vec3(0.0);\n      }\n  \n      gl_FragColor = vec4(color, 1.0);\n    }\n  `}))(e);n.shaderSource(t,r),n.compileShader(t);const o=n.createShader(n.FRAGMENT_SHADER);if(null===o)throw new Error("fragShader is null");n.shaderSource(o,c),n.compileShader(o);const a=n.createProgram();if(null===a)throw new Error("prog is null");return n.attachShader(a,t),n.attachShader(a,o),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||console.error(n.getProgramInfoLog(a)),a};let c=r(t);return{render:(t,r)=>{n.useProgram(c);const o=n.getUniformLocation(c,"u_res");n.uniform2f(o,e.width,e.height);const a=n.getUniformLocation(c,"u_zoom");n.uniform1f(a,t);const s=n.getUniformLocation(c,"u_center");n.uniform2f(s,r.x,r.y),n.viewport(0,0,e.width,e.height);const l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n.STATIC_DRAW);const i=n.getAttribLocation(c,"a_pos");n.enableVertexAttribArray(i),n.vertexAttribPointer(i,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLES,0,6)},updateParams:e=>{c=r(e)}}})(o,n);let f=0;const h=()=>{const e=Date.now();e-f>=8.333333333333334&&(f=e,v.render(l.scale,l.offset),g(a,p,n.function.native,d.value,!0))};return a.addEventListener("mousedown",(e=>{s=!0,d.value=(([e,t])=>{const{d1:n,d2:r,d3:c,d4:a}=u();return[x(e,0,o.width,n,r),x(t,0,o.height,c,a)]})([e.clientX,e.clientY]),d.clickTimestamp=Date.now(),a.style.cursor="grab"})),a.addEventListener("wheel",(n=>{n.preventDefault();const r=l.scale*(n.deltaY<0?1.1:.9),[c,o]=((e,t,n,r)=>{const[c,o]=i(e,t,n),[a,s]=i(e,t,r);return[c-a,o-s]})(2*(n.clientX/e-.5),2*(-n.clientY/t+.5),l.scale,r);l.scale=r,l.offset.x+=c,l.offset.y+=o,h()})),window.addEventListener("mouseup",(()=>{s=!1,Date.now()-d.clickTimestamp<100&&g(a,p,n.function.native,d.value),d.value=r.NaN(),a.style.cursor="auto"})),window.addEventListener("mousemove",(n=>{if(s){((e,t)=>{l.offset.x=e,l.offset.y=t})(l.offset.x-n.movementX/(e*l.scale*.5),l.offset.y+n.movementY/(t*l.scale*.5)),h()}})),window.addEventListener("resize",(()=>{e=o.clientWidth,t=o.clientHeight,o.width=e,o.height=t,a.width=e,a.height=t,h()})),h(),{updateParams:e=>{v.updateParams(e),n=e,h()}}};(async()=>{var e,r;await(e=()=>import("./Calculus.75988da5.js").then((function(e){return e.C})),r=["assets/Calculus.75988da5.js","assets/vendor.080e648e.js"],r&&0!==r.length?Promise.all(r.map((e=>{if((e=`/fractals/${e}`)in n)return;n[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const c=document.createElement("link");return c.rel=t?"stylesheet":"modulepreload",t||(c.as="script",c.crossOrigin=""),c.href=e,document.head.appendChild(c),t?new Promise(((e,t)=>{c.addEventListener("load",e),c.addEventListener("error",t)})):void 0}))).then((()=>e())):e());const c=(()=>{const e={"f(z)":u[0],"custom function":"z^2 - 1","color factor":1,"max iterations":50,"convergence threshold":.001,"brightness factor":4},n=e=>({function:m("custom"===e["f(z)"]?e["custom function"]:e["f(z)"]),colorAngleFactor:e["color factor"],maxIterations:e["max iterations"],convergencePrecision:e["convergence threshold"],brightnessFactor:-e["brightness factor"]}),r=new t.exports.Pane({container:document.querySelector("#pane"),title:"parameters"});r.addInput(e,"f(z)",{options:u.reduce(((e,t)=>(e[t]=t,e)),{custom:"custom"})});const c=r.addInput(e,"custom function",{disabled:!0});return r.addInput(e,"color factor",{min:0,max:Math.PI}),r.addInput(e,"brightness factor",{min:.01,max:12}),r.addInput(e,"max iterations",{min:1,max:400,step:1}),r.addInput(e,"convergence threshold",{min:1e-4,max:.999}),r.addButton({title:"save image"}).on("click",(()=>{const e=document.querySelector("#download-link"),t=document.querySelector("#cnv");e.href=t.toDataURL("image/png"),console.log(e.href),e.click()})),{params:()=>n(e),onChange:t=>{r.on("change",(()=>{c.disabled="custom"!==e["f(z)"],t(n(e))}))}}})(),o=z(window.innerWidth,window.innerHeight,c.params(),1);c.onChange(o.updateParams)})();
